#!/usr/bin/env coffee

_ = require 'lodash'

{Daemon} = require 'inform-daemon'
prefer = require 'prefer'

startDaemon = (err, preferences) ->
  daemon = new Daemon

  _.each preferences.plugins, (pluginSettings, pluginName) ->
    daemon.use pluginName, pluginSettings

  daemon.listen()

prefer.load 'informd.json', {}, (err, configurator) ->
  configurator.get startDaemon

