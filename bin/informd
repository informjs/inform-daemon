#!/usr/bin/env coffee


_ = require 'lodash'

{Daemon} = require 'inform-daemon'
prefer = require 'prefer'


startDaemon = (err, preferences) ->
  daemon = new Daemon

  _.each preferences.plugins, (pluginSettings, pluginName) ->
    daemon.use "inform-plugin-#{ pluginName }", pluginSettings

  daemon.listen()


prefer.load 'informd.json'
  .done (configurator) -> configurator.get startDaemon
